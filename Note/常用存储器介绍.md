# 存储器

---

> ​	存储器按其内存介质特性主要分为“**易失性存储器**”和**非易失性存储器**“两大类。其中”易失性“或”非易失性“是指存储器断电后，它存储的数据内容是或会丢失的特性。由于一般易失性存储器存取速度快，而非易失性存储器可长期保存数据，它们都在计算机中占据着重要角色。在计算机中易失性存储器最典型的代表是内存，非易失性存储器的代表则是硬盘。

---

![总览图](./img/image-3.png)

## 易失性存储器

### RAM（随机存取存储器)

​	RAM（Random Access Memory)是**随机存取存储器**，”**随机存取**“指的是当存储器中的消息被读取或写入时，所需要的时间与这段信息所在的	位置无关。

​	现在RAM已经专门用来指代作为计算机内存的易失性半导体存储器。

​	根据RAM的存储机制，又分为动态随机存储器DRAM（Dynamic RAM）以及静态随机存储器SRAM（Static RAM）两种。

#### DRAM（动态随机存取存储器）

​	动态随机存储器DRAM 的存储单元以电容的电荷来表示数据，有电荷代表1，无电荷代表0。但时间一长，代表1 的电容会放电，代表0 的电容会吸收电荷，因此它需要定期刷新操作，这就是“动态（Dynamic）”一词所形容的特性。刷新操作会对电容进行检查，若电量大于满电量的1/2，则认为其代表1，并把电容充满电；若电量小于1/2，则认为其代表0，并把电容放电，藉此来保证数据的正确性。

![图1](./img/image-2.png)

##### SDRAM（同步动态随机存取存储器）

​	根据DRAM 的通讯方式，又分为同步和异步两种，这两种方式根据通讯时是否需要使用时钟信号来区分。图 是一种利用时钟进行同步的通讯时序，它在时钟的上升沿表示有效数据。

![图2](./img/image-1.png)

​																		同步通讯时序图

​	由于使用时钟同步的通讯速度更快，所以同步DRAM 使用更为广泛，这种DRAM 被称为SDRAM（Synchronous DRAM）。

##### DDR SDRAM（Double Data Rate SDRAM）

​	为了进一步提高SDRAM 的通讯速度，人们设计了DDR SDRAM 存储器(Double Data Rate SDRAM)。它的存储特性与SDRAM 没有区别，但SDRAM 只在上升沿表示有效数据，在1 个时钟周期内，只能表示1 个有数据；而DDR SDRAM 在时钟的上升沿及下降沿各表示一个数据，也就是说在1 个时钟周期内可以表示2 位数据，在时钟频率同样的情况下，提高了一倍的速度。至于DDRII 和DDRIII，它们的通讯方式并没有区别，主要是通讯同步时钟的频率提高了。当前个人计算机常用的内存条是DDRIII SDRAM 存储器，在一个内存条上包含多个DDRIIISDRAM 芯片。

#### SRAM（静态随机存取存储器）

​	静态随机存储器SRAM 的存储单元以锁存器来存储数据，见图。这种电路结构不需要定时刷新充电，就能保持状态(当然，如果断电了，数据还是会丢失的)，所以这种存储器被称为“静态（Static）”RAM。

![图3](./img/image-4.png)

​	同样地，SRAM 根据其通讯方式也分为同步(SSRAM) 和异步SRAM，相对来说，异步SRAM 用得比较广泛。

#### DRAM 与 SRAM 的应用场合

​	对比DRAM 与SRAM 的结构，可知DRAM 的结构简单得多，所以生产相同容量的存储器，DRAM的成本要更低，且集成度更高。而DRAM 中的电容结构则决定了它的存取速度不如SRAM，特性对比见下表。

|     特性     | DRAM | SRAM |
| :----------: | :--: | :--: |
|   存取速度   | 较慢 | 较快 |
|    集成度    | 较高 | 较低 |
|   生产成本   | 较低 | 较高 |
| 是否需要刷新 |  是  |  否  |

​	所以在实际应用场合中，SRAM 一般只用于CPU 内部的高速缓存(Cache)，而外部扩展的内存一般使用DRAM。在STM32 系统的控制器中，只有STM32F429 型号或更高级的芯片才支持扩展SDRAM，其它型号如STM32F1、STM32F2 及STM32F407 等型号只能扩展SRAM。

## 非易失性存储器

​	非易失性存储器种类非常多，半导体类分为 **ROM** 和 **FLASH** 。其他的则包括光盘，软盘和机械硬盘等。

### ROM（只读存储器）

​	ROM 是“Read Only Memory”的缩写，意为只能读的存储器。由于技术的发展，后来设计出了可以方便写入数据的ROM，而这个“Read Only Memory”的名称被沿用下来了，**现在一般用于指代非易失性半导体存储器**，包括后面介绍的FLASH 存储器，有些人也把它归到ROM 类里边。

#### MASK ROM（掩膜只读存储器）

​	MASK ROM 就是正宗的“Read Only Memory”，存储在它内部的数据是在出厂时使用特殊
工艺固化的，**生产后就不可修改**，其主要优势是**大批量生产时成本低**。当前在生产量大，数据不
需要修改的场合，还有应用。

#### OTPROM（一次可编程只读存储器）

​	OTPROM（**One Time Programable ROM**） 是一次可编程存储器。这种存储器出厂时内部并没有资料，用户可以使用专用的编程器将自己的资料写入，但**只能写入一次**，被写入过后，它的内容也不可再修改。在NXP 公司生产的控制器芯片中常使用OTPROM 来存储密钥；在STM32F429 芯片中也具有一部分OTPROM 空间。

#### EPROM（可擦除可编程只读存储器）

​	EPROM(**Erasable Programmable ROM**) 是可重复擦写的存储器，它解决了PROM 芯片只能写入一次的问题。这种存储器使用紫外线照射芯片内部擦除数据，擦除和写入都要专用的设备。现在这种存储器基本淘汰，被EEPROM 取代。

#### EEPROM（电可擦除可编程只读存储器）

​	EEPROM(Electrically Erasable Programmable ROM) 是带电可擦除存储器。**EEPROM 可以重复擦写，它的擦除和写入都是直接使用电路控制，不需要再使用外部设备来擦写**。而且可以按字节为单位修改数据，无需整个芯片擦除。**现在主要使用的ROM 芯片都是EEPROM**。

### FLASH（闪存）

​	FLASH 存储器也是**可重复擦写的存储器**，部分书籍会把FLASH 存储器称为FLASH ROM，但**它的容量一般比EEPROM 大得多**，且在擦除时，一般以多个字节为单位。如有的FLASH存储器以4096 个字节为扇区，最小的擦除单位为一个扇区。根据存储单元电路的不同，FLASH存储器又分为**NOR FLASH** 和**NAND FLASH**，见下表：

| 特性 | NOR FLASH                  | NAND FLASH |
| :--: | :------------------------: | :--------: |
|同容量存储器成本|较贵|较便宜|
|集成度|较低|较高|
|介质类型|随机存储|连续存储|
|地址线和数据线|独立分开|共用|
|擦除单元|以“扇区/块”擦除|以“扇区/块”擦除|
|读写单元|可以基于字节读写|必须以“块”为单位读写|
|读取速度|较高|较低|
|写入速度|较低|较高|
|坏块|较少|较多|
|是否支持XIP| 支持|不支持|

​	NOR 与NAND 的共性是在数据写入前都需要有擦除操作，而擦除操作一般是以“扇区/块”为单位的。而NOR 与NAND 特性的差别，主要是由于其内部“地址/数据线”是否分开导致的。

​	由于NOR 的地址线和数据线分开，它可以按“字节”读写数据，符合CPU 的指令译码执行要求，所以假如NOR 上存储了代码指令，CPU 给NOR 一个地址，NOR 就能向CPU 返回一个数据让CPU 执行，中间不需要额外的处理操作。

​	而由于NAND 的数据和地址线共用，只能按“块”来读写数据，假如NAND 上存储了代码指令，CPU 给NAND 地址后，无法直接返回该地址的数据，所以不符合指令译码要求。上表中的最后一项“是否支持XIP”描述的就是这种立即执行的特性(execute In Place)。

​	若代码存储在NAND 上，可以把它先加载到RAM 存储器上，再由CPU 执行。所以在功能上可以认为NOR 是一种断电后数据不丢失的RAM，但它的擦除单位与RAM 有区别，且读写速度比RAM 要慢得多。
​	另外，FLASH 的擦除次数都是有限的(现在普遍是10 万次左右)，当它的使用接近寿命的时候，可能会出现写操作失败。由于NAND 通常是整块擦写，块内有一位失效整个块就会失效，这被称为坏块，而且由于擦写过程复杂，从整体来说NOR 块块更少，寿命更长。由于可能存在坏块，所以FLASH 存储器需要“探测/错误更正(EDC/ECC)”算法来确保数据的正确性。
​	由于两种FLASH 存储器特性的差异，NOR FLASH 一般应用在代码存储的场合，如嵌入式控制器内部的程序存储空间。而NAND FLASH 一般应用在大数据量存储的场合，包括SD 卡、U 盘以及固态硬盘等，都是NAND FLASH 类型的。
